<!DOCTYPE html>
<head>
	<title>JQEEEEEEEERY</title>
  <script src="jquery-2.1.1.js"></script>
  <script src="handlebars-v2.0.0.js"></script>
  <link rel="stylesheet" type="text/css" href="./public/css/chats.css">
</head>
<body>

<div class="bubble" class="signin">
    <input id="username" type="text" value="CuriousJorge">
    <input id="password" type="text" value="password">
    <button class="login">Login!</button>
    <button class="signup">Sign Up!</button>
</div>
<br>
	<br>
	<div class="bubble" class='send-message'>
		<form>
			<label>Message:</label>
			<textarea name='message'></textarea>
			<br>
			<input type='submit' value='Send Message' class='send-button'>
		</form>
	</div>
<div class="chats"></div>
</body>




<script id="chat-template" type="text/x-handlebars-template">
	<div class="bubble" class="chat">
		<h4>{{ user }}</h4>
		<p>{{ message }}</p>
	</div>
</script>

<script>
$(document).on("click", "button.login", function(){
	var username = $('#username').val()
  var password = $('#password').val()
  console.log(username, password)
  $.ajax({
  	url: 'http://chat.api.mks.io/signin',
		type: 'POST',
		data: {username: username, password: password}, 
  }).success(function (data) {
  	apiToken = data.apiToken
  	console.log(apiToken)
  })
})
$(document).on("click", ".send-button", function(e){
e.preventDefault()
	$.ajax({
		url: 'http://chat.api.mks.io/chats',
		type: 'POST',
		dataType: 'text',
		data: {
			apiToken: apiToken,
			message: $('textarea[name=message]').val()
		}	
		}).done(function(data) {
			console.log(data)
	})
})
</script>


<script>
	$.ajax({
	  type: 'GET',
	  url: 'http://chat.api.mks.io/chats'
	}).success(function (chats) {
	  console.log("Got chats:", chats)
	})
</script>


<script>
      var source = $("#chat-template").html();
      var template = Handlebars.compile(source);
      $.ajax({
  type: 'GET',
  url: 'http://chat.api.mks.io/chats'
}).success(function (chats) {
  chats.forEach(function(chat){
    var myNewHTML = template({
        user: chat['user'],
        message: chat['message'],
        time: chat['time']
      });
        $('body').append(myNewHTML);
  })
})
      var anotherHTML = template({
        title: "New Title",
        content: "New Content"
      });
  </script>
